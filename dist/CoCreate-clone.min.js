!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.CoCreate=t():(e.CoCreate=e.CoCreate||{},e.CoCreate.clone=t())}(this,(function(){return(()=>{var e={727:(e,t,n)=>{"use strict";function r(e,t,n){if(t){if(e.classList.contains(t))return e;let n=e.parentNode;for(;null!=n&&n.classList;){if(n.classList.contains(t))return n;n=n.parentNode}}else if(n){if(n.every((t=>e.attributes.hasOwnProperty(t))))return e;let t=e.parentNode;for(;null!=t&&t.attributes;){if(n.every((e=>t.attributes.hasOwnProperty(e))))return t;t=t.parentNode}}return!1}function o(e){try{let t=JSON.parse(e);return"object"==typeof t&&null!=t}catch(e){return!1}}function a(e){return e.getAttributeNames().reduce(((t,n)=>(t[n]=e.getAttribute(n),t)),{})}function l(e){return!!e&&!/{{\s*([\w\W]+)\s*}}/g.test(e)}function i(e){let t=[{document,window}];for(let e of document.querySelectorAll("iframe")){let n=e.contentDocument||e.contentWindow.document,r=e.contentWindow;t.push({document:n,window:r,frameElement:e})}let n=new Set;for(let r of t){let t=e(r);t&&"function"==typeof t[Symbol.iterator]?t.forEach((e=>n.add(e))):t&&n.add(t)}return Array.from(n)}function c(e){let t=[];do{if(!e||!e.tagName)return!1;let n=e.tagName.toLowerCase();if(e.id&&"BODY"!==e.tagName&&(n+="#"+e.id),e.classList.length&&"BODY"!==e.tagName&&e.classList.forEach((e=>{-1===e.indexOf(":")&&(n+="."+e)})),"BODY"!==e.tagName&&e.parentNode){let t=Array.prototype.indexOf.call(e.parentNode.children,e);n+=`:nth-child(${t+1})`}t.unshift(n),e=e.parentNode}while("HTML"!==e.tagName);return t.join(" > ")}function u(){let e=window;for(;e!==window.parent;)e=window.parent;return e}function d(e,t){let n;return i((e=>{e.document.contains(t)&&(n=e.frameElement)})),n}function s(e){let t=u;return e.forEach((e=>{t&&(t=t.querySelector(e))})),t}function*f(e,t){for(let n of e)n.selector&&t.matches(n.selector)&&(yield n)}function m(e,t,n,r){for(let o of f(r||window.elementConfig,e)){if(!0===o[t])return n(e,o);if(!1===o[t])return!1;if(void 0===o[t])continue;if(y(o[t]))return n(e,o,!0)}return!1}function g(e=10){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",r=n.length,o=0;o<e;o++)t+=n.charAt(Math.floor(Math.random()*r));return t+=(new Date).toTimeString().replace(/[\W_]+/g,"").substr(0,6)}function p(e){let t=(new DOMParser).parseFromString(e,"text/html");return t.head.children[0]?t.head.children[0]:t.body.children[0]}function h(e,t){return e.split(t).map((e=>e.trim()))}function b(e,t){return e.map((e=>e.trim())).join(t)}function y(e){try{document.createDocumentFragment().querySelector(e)}catch(e){return!1}return!0}function _(e,t){let n=[],r=(window,d(0,e)),o=c(r);return o&&n.unshift(o),t?{path:n,document:r||document}:n}function x(e="all"){if(!["all","error","warn","log","off"].includes(e))throw new Error("level must be one of all, error, warn, log or off");return{error:function(t){["all","error"].includes(e)},warn:function(t){["all","error","warn"].includes(e)},log:function(){["all","error","warn","log"].includes(e)}}}async function C(e){if("loading"===e.contentDocument.readyState)try{await new Promise(((t,n)=>{e.contentWindow.addEventListener("load",(e=>t()))}))}catch(e){}}function w(e,t){let n=t.split(";"),r=e;for(let e=0;e<n.length-1;e++)if(r=r.querySelector(n[e]),!r)return[];return[this,[n.length-1]]}function v(e){let[t,n]=w(this,e);return t?t.contentWindow.document.querySelector(n):null}function E(e){let[t,n]=w(this,e);return t?t.contentWindow.document.querySelectorAll(n):[]}n.r(t),n.d(t,{getParentFromElement:()=>r,isJsonString:()=>o,getAttributes:()=>a,checkValue:()=>l,allFrame:()=>i,cssPath:()=>c,getTopMostWindow:()=>u,findIframeFromElement:()=>d,getIframeFromPath:()=>s,configMatch:()=>f,configExecuter:()=>m,UUID:()=>g,parseTextToHtml:()=>p,splitBydelimiter:()=>h,joinBydelimiter:()=>b,isValidSelector:()=>y,getElementPath:()=>_,logger:()=>x,waitForLoad:()=>C,getComplexSelector:()=>w,frameQuerySelector:()=>v,frameQuerySelectorAll:()=>E,default:()=>A});const A={getElementPath:_,isValidSelector:y,joinBydelimiter:b,splitBydelimiter:h,parseTextToHtml:p,UUID:g,configExecuter:m,configMatch:f,getIframeFromPath:s,findIframeFromElement:d,getTopMostWindow:u,cssPath:c,allFrame:i,checkValue:l,getAttributes:a,isJsonString:o,getParentFromElement:r,logger:x}},212:function(e,t){var n;"undefined"!=typeof self&&self,void 0===(n=function(){return function(e){const t={attribute:"data-uuid",init:function(t){if(!e.document)return;const n=t||e.document;if(!n.querySelectorAll)return;let r=n.querySelectorAll(`[${this.attribute}]`);const o=this;r.forEach((e=>{const t=parseInt(e.getAttribute(o.attribute))||36,n=o.generate(t);"INPUT"===e.tagName||"TEXTAREA"===e.tagName?e.value=n:e.innerHTML=n}))},generate:function(t=36){let n=(new Date).getTime(),r=e.performance&&e.performance.now&&1e3*e.performance.now()||0,o="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx";if(t<=o.length)o=o.substr(0,t);else{let e=t-o.length,n="-xxxyyxxx",r=Math.floor(e/n.length);for(let e=0;e<r;e++)o+=n;r=e-r*n.length,o+=n.substr(0,r)}return o.replace(/[xy]/g,(function(e){var t=16*Math.random();return n>0?(t=(n+t)%16|0,n=Math.floor(n/16)):(t=(r+t)%16|0,r=Math.floor(r/16)),("x"==e?t:7&t|8).toString(16)}))}};return t.init(),t}(window)}.apply(t,[]))||(e.exports=n)}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={exports:{}};return e[r].call(a.exports,a,a.exports,n),a.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};return(()=>{"use strict";var e=r;e.default=void 0;var t=a(n(727)),o=a(n(212));function a(e){return e&&e.__esModule?e:{default:e}}const l={__cloneBtnClass:"cloneBtn",__deleteBtnClass:"deleteBtn",init:function(){this.__initButtonEvent(),CoCreate.socket.listen("CoCreateClone-insert",(function(e){let{selector:t,element_str:n,position:r}=e;if(!t)return;let o=document.querySelector(t);o&&(r="after"==r?"afterend":"beforebegin",o.insertAdjacentHTML(r,n))})),CoCreate.socket.listen("CoCreateClone-delete",(function(e){let{element_id:t}=e;if(!t)return;let n=document.getElementById(t);n&&n.remove()}))},__initButtonEvent:function(){},cloneElement:function(e){const n=e.getAttribute("data-clone_id"),r=e.getAttribute("data-clone_name"),o=e.getAttribute("data-clone_position")||"before";if(!n)return;let a,l=document.getElementById(r);l&&(a=l.value?l.value:"");let i=document.getElementById(n);if(!i)return;let c=i.cloneNode(!0);c.classList.contains("template")&&c.classList.remove("template"),c.classList.add("clonedItem"),c.removeAttribute("data-pass_value_id"),c.querySelectorAll("*").forEach((e=>{e.removeAttribute("data-pass_value_id")}));let u=this.__getNewPrefix(a);this.__createDynamicCloneId(c,u),this.__createDnDElementId(c),"after"===o?i.nextSibling?i.parentNode.insertBefore(c,i.nextSibling):i.parentNode.appendChild(c):i.parentNode.insertBefore(c,i);const d=t.default.getParentFromElement(c);d&&this.__sendMessageOfClone(d,c,n,o),document.dispatchEvent(new CustomEvent("change-content",{detail:{element:c,type:"clone-create"}})),i.parentNode.dispatchEvent(new CustomEvent("CoCreate-clone",{detail:{type:"create"}})),document.dispatchEvent(new CustomEvent("clone-cloned",{detail:{element:c}}))},deleteElement:function(e){let t=e.getAttribute("data-clone_id"),n=document.getElementById(t);if(n){const e=n.parentNode;n.remove(),this.__sendMessageOfDelete(t),e&&(document.dispatchEvent(new CustomEvent("change-content",{detail:{element:e,type:"clone-delete"}})),e.dispatchEvent(new CustomEvent("CoCreate-clone",{detail:{type:"delete"}}))),document.dispatchEvent(new CustomEvent("clone-deleted",{detail:{}}))}},__createDynamicCloneId:function(e,t){const n=this;let r=e.querySelectorAll("*"),o=e.querySelectorAll("."+this.__cloneBtnClass),a=e.querySelectorAll("."+this.__deleteBtnClass);r=Array.from(r),r.push(e),e.setAttribute("id",t),r.forEach((e=>{let n=e.tagName.toLowerCase();for(var r=0;r<e.attributes.length;r++){const{name:o,value:a}=e.attributes[r],l=a.replace(/{{\s*clone-name\s*}}/g,t);if(/{{\s*clone-name\s*}}/g.test(a)&&"value"==o)switch(n){case"input":e.setAttribute("value",l);break;case"textarea":e.setAttribute("value",l),e.textContent=l;break;default:e.innerHTML=l}e.setAttribute(o,l)}})),o.forEach((r=>{let o=r.getAttribute("data-clone_id"),a=r.getAttribute("data-clone_name");if(o){let a=e.querySelector(`#${o}`),l=n.__setAttribute(r,"data-clone_id",o,t);a&&(a.id=l)}if(a){let o=e.querySelector(`#${a}`),l=n.__setAttribute(r,"data-clone_name",a,t);o&&(o.id=l)}})),a.forEach((e=>{e.getAttribute("data-clone_id")&&e.setAttribute("data-clone_id",t)}))},__getOriginal:function(e){let t=e,n=e.indexOf("_");return n>-1&&(t=e.substring(n+1)),t},__setAttribute:function(e,t,n,r){let o=this.__getOriginal(n),a=""==r?o:`${r}_${o}`;return e.setAttribute(t,a),a},__createDnDElementId:function(e){document.querySelectorAll('[data-draggable="true"], [data-droppable="true"]').forEach((e=>{e.setAttribute("data-element_id",o.default.generate())})),"true"!=e.getAttribute("data-draggable")&&"true"!=e.getAttribute("data-droppable")||e.setAttribute("data-element_id",o.default.generate())},__getNewPrefix:function(e){let t=document.querySelectorAll(".clonedItem"),n=!1;return t.forEach((t=>{let r=t.getAttribute("prefix");e!=r||(n=!0)})),n||!e?o.default.generate():e},__sendMessageOfClone:function(e,t,n,r){const o=e.getAttribute("data-document_id")||"",a=e.getAttribute("name")||"";let l="";o&&(l=`[data-document_id='${o}']`,a&&(l+=`[name='${a}']`),CoCreate.message.send({rooms:[],emit:{message:"CoCreateClone-insert",data:{selector:`div.domEditor${l} #${n}.template`,element_str:t.outerHTML,position:r}}}))},__sendMessageOfDelete:function(e){CoCreate.message.send({rooms:[],emit:{message:"CoCreateClone-remove",data:{element_id:e}}})}};l.init(),CoCreate.action.init({action:"cloneAction",endEvent:"clone-cloned",callback:(e,t)=>{l.cloneElement(e)}}),CoCreate.action.init({action:"createClone",endEvent:"clone-cloned",callback:(e,t)=>{l.cloneElement(e)}}),CoCreate.action.init({action:"deleteClone",endEvent:"clone-deleted",callback:(e,t)=>{l.deleteElement(e)}});var i=l;e.default=i})(),r=r.default})()}));