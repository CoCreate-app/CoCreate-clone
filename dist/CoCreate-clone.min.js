!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.CoCreate=t():(e.CoCreate=e.CoCreate||{},e.CoCreate.clone=t())}(this,(function(){return(()=>{"use strict";var e={};return(()=>{var t=e;t.default=void 0;const n={__cloneBtnClass:"cloneBtn",__deleteBtnClass:"deleteBtn",init:function(){this.__initButtonEvent(),CoCreate.socket.listen("CoCreateClone-insert",(function(e){let{selector:t,element_str:n,position:o}=e;if(!t)return;let a=document.querySelector(t);a&&(o="after"==o?"afterend":"beforebegin",a.insertAdjacentHTML(o,n))})),CoCreate.socket.listen("CoCreateClone-delete",(function(e){let{element_id:t}=e;if(!t)return;let n=document.getElementById(t);n&&n.remove()}))},__initButtonEvent:function(){},cloneElement:function(e){const t=e.getAttribute("data-clone_id"),n=e.getAttribute("data-clone_name"),o=e.getAttribute("data-clone_position")||"before";if(!t)return;let a,l=document.getElementById(n);l&&(a=l.value?l.value:"");let r=document.getElementById(t);if(!r)return;let i=r.cloneNode(!0);i.classList.contains("template")&&i.classList.remove("template"),i.classList.add("clonedItem"),i.removeAttribute("data-pass_value_id"),i.querySelectorAll("*").forEach((e=>{e.removeAttribute("data-pass_value_id")}));let c=this.__getNewPrefix(a);this.__createDynamicCloneId(i,c),this.__createDnDElementId(i),"after"===o?r.nextSibling?r.parentNode.insertBefore(i,r.nextSibling):r.parentNode.appendChild(i):r.parentNode.insertBefore(i,r);const d=CoCreate.htmlTags.findElementByChild(i);d&&this.__sendMessageOfClone(d,i,t,o),document.dispatchEvent(new CustomEvent("change-content",{detail:{element:i,type:"clone-create"}})),r.parentNode.dispatchEvent(new CustomEvent("CoCreate-clone",{detail:{type:"create"}})),document.dispatchEvent(new CustomEvent("clone-cloned",{detail:{element:i}}))},deleteElement:function(e){let t=e.getAttribute("data-clone_id"),n=document.getElementById(t);if(n){const e=n.parentNode;n.remove(),this.__sendMessageOfDelete(t),e&&(document.dispatchEvent(new CustomEvent("change-content",{detail:{element:e,type:"clone-delete"}})),e.dispatchEvent(new CustomEvent("CoCreate-clone",{detail:{type:"delete"}}))),document.dispatchEvent(new CustomEvent("clone-deleted",{detail:{}}))}},__createDynamicCloneId:function(e,t){const n=this;let o=e.querySelectorAll("*"),a=e.querySelectorAll("."+this.__cloneBtnClass),l=e.querySelectorAll("."+this.__deleteBtnClass);o=Array.from(o),o.push(e),e.setAttribute("id",t),o.forEach((e=>{let n=e.tagName.toLowerCase();for(var o=0;o<e.attributes.length;o++){const{name:a,value:l}=e.attributes[o],r=l.replace(/{{\s*clone-name\s*}}/g,t);if(/{{\s*clone-name\s*}}/g.test(l)&&"value"==a)switch(n){case"input":e.setAttribute("value",r);break;case"textarea":e.setAttribute("value",r),e.textContent=r;break;default:e.innerHTML=r}e.setAttribute(a,r)}})),a.forEach((o=>{let a=o.getAttribute("data-clone_id"),l=o.getAttribute("data-clone_name");if(a){let l=e.querySelector(`#${a}`),r=n.__setAttribute(o,"data-clone_id",a,t);l&&(l.id=r)}if(l){let a=e.querySelector(`#${l}`),r=n.__setAttribute(o,"data-clone_name",l,t);a&&(a.id=r)}})),l.forEach((e=>{e.getAttribute("data-clone_id")&&e.setAttribute("data-clone_id",t)}))},__getOriginal:function(e){let t=e,n=e.indexOf("_");return n>-1&&(t=e.substring(n+1)),t},__setAttribute:function(e,t,n,o){let a=this.__getOriginal(n),l=""==o?a:`${o}_${a}`;return e.setAttribute(t,l),l},__createDnDElementId:function(e){document.querySelectorAll('[data-draggable="true"], [data-droppable="true"]').forEach((e=>{e.setAttribute("data-element_id",CoCreate.utils.generateUUID())})),"true"!=e.getAttribute("data-draggable")&&"true"!=e.getAttribute("data-droppable")||e.setAttribute("data-element_id",CoCreate.utils.generateUUID())},__getNewPrefix:function(e){let t=document.querySelectorAll(".clonedItem"),n=!1;return t.forEach((t=>{let o=t.getAttribute("prefix");e!=o||(n=!0)})),n||!e?CoCreate.utils.generateUUID(12):e},__sendMessageOfClone:function(e,t,n,o){const a=e.getAttribute("data-document_id")||"",l=e.getAttribute("name")||"";let r="";a&&(r=`[data-document_id='${a}']`,l&&(r+=`[name='${l}']`),CoCreate.message.send({rooms:[],emit:{message:"CoCreateClone-insert",data:{selector:`div.domEditor${r} #${n}.template`,element_str:t.outerHTML,position:o}}}))},__sendMessageOfDelete:function(e){CoCreate.message.send({rooms:[],emit:{message:"CoCreateClone-remove",data:{element_id:e}}})}};n.init(),CoCreate.action.init({action:"cloneAction",endEvent:"clone-cloned",callback:(e,t)=>{n.cloneElement(e)}}),CoCreate.action.init({action:"createClone",endEvent:"clone-cloned",callback:(e,t)=>{n.cloneElement(e)}}),CoCreate.action.init({action:"deleteClone",endEvent:"clone-deleted",callback:(e,t)=>{n.deleteElement(e)}});var o=n;t.default=o})(),e=e.default})()}));