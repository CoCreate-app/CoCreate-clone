/* CoCreateJS */
var cloneBtnClass="cloneBtn",deleteBtnClass="deleteBtn";function initBtns(){document.addEventListener("click",function(e){for(let t=0;t<e.path.length;t++){let l=e.path[t];l.classList&&l.classList.contains(cloneBtnClass)&&clickedCloneBtn(l),l.classList&&l.classList.contains(deleteBtnClass)&&clickedDeleteBtn(l)}})}function clickedCloneBtn(e){let t,l=e.getAttribute("data-clone_id"),n=e.getAttribute("data-clone_name");if(!l)return;let i=document.getElementById(n);i&&(t=i.value?i.value:"");let o=document.querySelector("#"+l+".template");if(!o)return;let r=o.cloneNode(!0);r.classList.remove("template"),r.classList.add("clonedItem"),r.removeAttribute("data-pass_value_id");let a=r.querySelectorAll("*");for(let e=0;e<a.length;e++){a[e].removeAttribute("data-pass_value_id")}let c=getNewPrefix(t);r.setAttribute("prefix",c),createDynamicCloneId(r,c),o.parentNode.insertBefore(r,o),initCrudForClone(r);let d=findSaveFetchElByChild(r);d&&saveHtml(d),createSortableForSaveFetch(r)}function clickedDeleteBtn(e){console.log(e);let t=e.getAttribute("data-clone_id");console.log(t);let l=document.getElementById(t);if(console.log(l),l){let e=findSaveFetchElByChild(l);l.remove(),e&&saveHtml(e)}}function createDynamicCloneId(e,t){let l=e.querySelectorAll("*");for(let e=0;e<l.length;e++){let n=l[e],i=n.getAttribute("name");if(!i)continue;let o=getOriginal(i);i=""==t?o:t+"_"+o,n.setAttribute("name",i)}let n=e.getAttribute("name");if(n){let l=getOriginal(n);n=""==t?l:t+"_"+l,e.setAttribute("name",n)}let i=getOriginal(e.id),o=""==t?i:t+"_"+i;e.setAttribute("id",o);let r=e.querySelectorAll("."+cloneBtnClass),a=e.querySelectorAll("."+deleteBtnClass);e.querySelectorAll("*").forEach(e=>{for(var l in e.dataset)e.setAttribute("data-"+l,e.dataset[l].replace(/\[prefix\]/g,t))});for(let l=0;l<r.length;l++){let n,i,o=r[l],a=o.getAttribute("data-clone_id"),c=o.getAttribute("data-clone_name");c&&(i=e.querySelector("#"+c)),n=e.querySelector("#"+a);let d=getOriginal(a),s=""==t?d:t+"_"+d;if(o.setAttribute("data-clone_id",s),n&&(n.id=s),i){let e=getOriginal(c),l=""==t?e:t+"_"+e;o.setAttribute("data-clone_name",l),i.id=l}}for(let e=0;e<a.length;e++){let l=a[e],n=getOriginal(l.getAttribute("data-clone_id")),i=""==t?n:t+"_"+n;l.setAttribute("data-clone_id",i)}}function getOriginal(e){let t=e,l=e.indexOf("_");return l>-1&&(t=e.substring(l+1)),t}function getNewPrefix(e){let t=document.getElementsByClassName("clonedItem"),l=!1;for(let n=0;n<t.length;n++){e!=t[n].getAttribute("prefix")||(l=!0)}return l?getRandomStringForDynamic():void 0==e?getRandomStringForDynamic():e}function getRandomStringForDynamic(e=8){let t="",l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=l.length,o=n.length;t+=l.charAt(Math.floor(Math.random()*i));for(let l=0;l<e-1;l++)t+=n.charAt(Math.floor(Math.random()*o));return t}function createdDocumentForClone(e){console.log(e);let t=e.element;if(t){let l=document.getElementById(t);if(l){"module_activity"==e.collection&&l.setAttribute("data-module_activity_id",e.document_id)}}}function initCrudForClone(e){"FORM"==e.tagName&&CoCreateForm.initForm(e);let t=e.querySelectorAll("form");for(let e=0;e<t.length;e++)CoCreateForm.initForm(t[e])}initSocketsForClone(),initSaveFetchEls(),initBtns();