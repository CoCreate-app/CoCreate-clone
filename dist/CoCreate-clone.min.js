!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.CoCreate=t():(e.CoCreate=e.CoCreate||{},e.CoCreate.clone=t())}(this,(function(){return(()=>{var e={212:function(e,t){var n;"undefined"!=typeof self&&self,void 0===(n=function(){return function(e){const t={attribute:"data-uuid",init:function(t){if(!e.document)return;const n=t||e.document;if(!n.querySelectorAll)return;let o=n.querySelectorAll(`[${this.attribute}]`);const a=this;o.forEach((e=>{const t=parseInt(e.getAttribute(a.attribute))||36,n=a.generate(t);"INPUT"===e.tagName||"TEXTAREA"===e.tagName?e.value=n:e.innerHTML=n}))},generate:function(t=36){let n=(new Date).getTime(),o=e.performance&&e.performance.now&&1e3*e.performance.now()||0,a="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx";if(t<=a.length)a=a.substr(0,t);else{let e=t-a.length,n="-xxxyyxxx",o=Math.floor(e/n.length);for(let e=0;e<o;e++)a+=n;o=e-o*n.length,a+=n.substr(0,o)}return a.replace(/[xy]/g,(function(e){var t=16*Math.random();return n>0?(t=(n+t)%16|0,n=Math.floor(n/16)):(t=(o+t)%16|0,o=Math.floor(o/16)),("x"==e?t:7&t|8).toString(16)}))}};return t.init(),t}(window)}.apply(t,[]))||(e.exports=n)}},t={};function n(o){var a=t[o];if(void 0!==a)return a.exports;var r=t[o]={exports:{}};return e[o].call(r.exports,r,r.exports,n),r.exports}var o={};return(()=>{"use strict";var e=o;e.default=void 0;var t,a=(t=n(212))&&t.__esModule?t:{default:t};const r={__cloneBtnClass:"cloneBtn",__deleteBtnClass:"deleteBtn",init:function(){this.__initButtonEvent(),CoCreate.socket.listen("CoCreateClone-insert",(function(e){let{selector:t,element_str:n,position:o}=e;if(!t)return;let a=document.querySelector(t);a&&(o="after"==o?"afterend":"beforebegin",a.insertAdjacentHTML(o,n))})),CoCreate.socket.listen("CoCreateClone-delete",(function(e){let{element_id:t}=e;if(!t)return;let n=document.getElementById(t);n&&n.remove()}))},__initButtonEvent:function(){},cloneElement:function(e){const t=e.getAttribute("data-clone_id"),n=e.getAttribute("data-clone_name"),o=e.getAttribute("data-clone_position")||"before";if(!t)return;let a,r=document.getElementById(n);r&&(a=r.value?r.value:"");let l=document.getElementById(t);if(!l)return;let i=l.cloneNode(!0);i.classList.contains("template")&&i.classList.remove("template"),i.classList.add("clonedItem"),i.removeAttribute("data-pass_value_id"),i.querySelectorAll("*").forEach((e=>{e.removeAttribute("data-pass_value_id")}));let c=this.__getNewPrefix(a);this.__createDynamicCloneId(i,c),this.__createDnDElementId(i),"after"===o?l.nextSibling?l.parentNode.insertBefore(i,l.nextSibling):l.parentNode.appendChild(i):l.parentNode.insertBefore(i,l);const d=CoCreate.htmlTags.findElementByChild(i);d&&this.__sendMessageOfClone(d,i,t,o),document.dispatchEvent(new CustomEvent("change-content",{detail:{element:i,type:"clone-create"}})),l.parentNode.dispatchEvent(new CustomEvent("CoCreate-clone",{detail:{type:"create"}})),document.dispatchEvent(new CustomEvent("clone-cloned",{detail:{element:i}}))},deleteElement:function(e){let t=e.getAttribute("data-clone_id"),n=document.getElementById(t);if(n){const e=n.parentNode;n.remove(),this.__sendMessageOfDelete(t),e&&(document.dispatchEvent(new CustomEvent("change-content",{detail:{element:e,type:"clone-delete"}})),e.dispatchEvent(new CustomEvent("CoCreate-clone",{detail:{type:"delete"}}))),document.dispatchEvent(new CustomEvent("clone-deleted",{detail:{}}))}},__createDynamicCloneId:function(e,t){const n=this;let o=e.querySelectorAll("*"),a=e.querySelectorAll("."+this.__cloneBtnClass),r=e.querySelectorAll("."+this.__deleteBtnClass);o=Array.from(o),o.push(e),e.setAttribute("id",t),o.forEach((e=>{let n=e.tagName.toLowerCase();for(var o=0;o<e.attributes.length;o++){const{name:a,value:r}=e.attributes[o],l=r.replace(/{{\s*clone-name\s*}}/g,t);if(/{{\s*clone-name\s*}}/g.test(r)&&"value"==a)switch(n){case"input":e.setAttribute("value",l);break;case"textarea":e.setAttribute("value",l),e.textContent=l;break;default:e.innerHTML=l}e.setAttribute(a,l)}})),a.forEach((o=>{let a=o.getAttribute("data-clone_id"),r=o.getAttribute("data-clone_name");if(a){let r=e.querySelector(`#${a}`),l=n.__setAttribute(o,"data-clone_id",a,t);r&&(r.id=l)}if(r){let a=e.querySelector(`#${r}`),l=n.__setAttribute(o,"data-clone_name",r,t);a&&(a.id=l)}})),r.forEach((e=>{e.getAttribute("data-clone_id")&&e.setAttribute("data-clone_id",t)}))},__getOriginal:function(e){let t=e,n=e.indexOf("_");return n>-1&&(t=e.substring(n+1)),t},__setAttribute:function(e,t,n,o){let a=this.__getOriginal(n),r=""==o?a:`${o}_${a}`;return e.setAttribute(t,r),r},__createDnDElementId:function(e){document.querySelectorAll('[data-draggable="true"], [data-droppable="true"]').forEach((e=>{e.setAttribute("data-element_id",a.default.generate())})),"true"!=e.getAttribute("data-draggable")&&"true"!=e.getAttribute("data-droppable")||e.setAttribute("data-element_id",a.default.generate())},__getNewPrefix:function(e){let t=document.querySelectorAll(".clonedItem"),n=!1;return t.forEach((t=>{let o=t.getAttribute("prefix");e!=o||(n=!0)})),n||!e?a.default.generate():e},__sendMessageOfClone:function(e,t,n,o){const a=e.getAttribute("data-document_id")||"",r=e.getAttribute("name")||"";let l="";a&&(l=`[data-document_id='${a}']`,r&&(l+=`[name='${r}']`),CoCreate.message.send({rooms:[],emit:{message:"CoCreateClone-insert",data:{selector:`div.domEditor${l} #${n}.template`,element_str:t.outerHTML,position:o}}}))},__sendMessageOfDelete:function(e){CoCreate.message.send({rooms:[],emit:{message:"CoCreateClone-remove",data:{element_id:e}}})}};r.init(),CoCreate.action.init({action:"cloneAction",endEvent:"clone-cloned",callback:(e,t)=>{r.cloneElement(e)}}),CoCreate.action.init({action:"createClone",endEvent:"clone-cloned",callback:(e,t)=>{r.cloneElement(e)}}),CoCreate.action.init({action:"deleteClone",endEvent:"clone-deleted",callback:(e,t)=>{r.deleteElement(e)}});var l=r;e.default=l})(),o=o.default})()}));